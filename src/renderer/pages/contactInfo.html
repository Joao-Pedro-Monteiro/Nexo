<!DOCTYPE html>
<html lang="pt_BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexo - Contato</title>

    <link href="../style/base.css" type="text/css" rel="stylesheet">
    <link href="../style/contactInfo.css" type="text/css" rel="stylesheet">
    
    <script src="../script/redir.js" type="text/javascript"></script>
    <script src="../middleware/childprocess.js" type="text/javascript"></script>
    <script src="../script/contactQuery.js" type="text/javascript"></script>
    <script src="../script/config.js" type="text/javascript"></script>
</head>

<script>
    let name = localStorage.getItem('ContactInfo_selectedContactName');
    const contact = contactQuery(name);

    if(contact != undefined){
        // Se o contato existe, espera a página carregar e plota os dados
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('contact-name').innerHTML = contact.name;
            document.getElementById('contact-phone').innerHTML = contact.phone;
            document.getElementById('contact-email').innerHTML = contact.email;;

            // Email
            if(contact.email.length > 0 && contact.email.includes('@')){
                document.getElementById('contact-EmailRedirBtn').setAttribute('onclick', `openWithBrowser('https://mail.google.com/mail/?view=cm&to=` + contact.email + `')`);
            } else {
                document.getElementById('contact-EmailRedirBtn').style.display = 'none';
            }

            // Instagram
            if(contact.instagram.length > 0){
                if(contact.instagram.includes('@')){
                    contact.instagram = contact.instagram.replace('@', '');
                }
                document.getElementById('contact-IgRedirBtn').setAttribute('onclick', `openWithBrowser('https://instagram.com/` + contact.instagram + `')`);
            } else {
                document.getElementById('contact-IgRedirBtn').style.display = 'none';
            }
            
            // WhatsApp
            const onlyNumbersPhone = contact.phone.replace(/[^0-9]/g, '');
            document.getElementById('contact-WppRedirBtn').setAttribute('onclick', `openWhatsAppWithNumber('${onlyNumbersPhone}')`);
                // Compartilhar
                document.getElementById('contact-ShareBtn').addEventListener('click', (e)=>{
                    const mensagem = `Contato para salvar:%0A*${contact.name}*%0ANúmero: ${contact.phone}`;
                    const link = `https://api.whatsapp.com/send/?text=${mensagem}`;
                    Childprocess.openWithBrowser(link);
                })
            })

    } else {
        console.error('Contato não encontrado');
    }   

</script>

<body>
    <header><img id="headerWordmark" src="../images/SVG/wordmark.svg" alt="Nexo" onclick="redir('./index.html')"></header>
        <main id="main">
            <section id="leftSection">
                <nav id="navigationBar">
                    <span class="navigationBar_item" id="navigationBar_item_contacts" onclick="redir('./index.html')">
                        <img src="../images/SVG/contacts.svg">
                        <p>Contatos</p>
                    </span>
                    <span class="navigationBar_item" id="navigationBar_item_new" onclick="redir('./newContact.html')">
                        <img src="../images/SVG/add_circle.svg">
                        <p>Novo</p>
                    </span>
                </nav>
            </section>
            <section id="centerSection">

                <div id="contact-infoContainer">
                    <img id="contact-avatar" src="../images/SVG/avatar.svg">
                    <h1 id="contact-name"></h1>
                </div>

                <section id="contact-infoContainer2">
                    <span class="contact-infoBox" name="Phone">
                        <img src="../images/SVG/contactInfo_phone.svg">
                        <p id="contact-phone"></p>
                    </span>

                    <span class="contact-infoBox" name="Email">
                        <img src="../images/SVG/contactInfo_email.svg">
                        <p id="contact-email"></p>
                        <button class="contact-infoBox-openInNew" id="contact-EmailRedirBtn" type="button" title="Ir para" onclick="">
                            <img src="../images/SVG/openInNew.svg">
                        </button>
                    </span>

                    <span class="contact-infoBox" name="WhatsApp">
                        <img src="../images/SVG/contactInfo_whatsapp.svg">
                        <p id="contact-whatsapp">Ir para WhatsApp</p>
                        <button class="contact-infoBox-openInNew" id="contact-WppRedirBtn" type="button" title="Ir para" onclick="">
                            <img src="../images/SVG/openInNew.svg">
                        </button>
                    </span>
                    
                    <span class="contact-infoBox" name="Instagram">
                        <img src="../images/SVG/contactInfo_instagram.svg">
                        <p id="contact-instagram">Ir para o Instagram</p>
                        <button class="contact-infoBox-openInNew" id="contact-IgRedirBtn" type="button" title="Ir para" onclick="">
                            <img src="../images/SVG/openInNew.svg">
                        </button>
                    </span>

                    <span class="contact-infoBox" name="Share" style="margin-top: 30px;">
                        <img src="../images/SVG/share.svg">
                        <p id="contact-ShareBtn">Compartilhar</p>
                    </span>
                </section>

            </section>
            <section id="rightSection"></section>
        </main>
</body>
</html>
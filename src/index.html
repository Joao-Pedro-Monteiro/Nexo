<!DOCTYPE html>
<html lang="pt_BR">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>Nexo</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="style/base.css" type="text/css" rel="stylesheet">
        <link href="style/home.css" type="text/css" rel="stylesheet">
        <script src="./behavior/contactListItem.js" type="text/javascript"></script>
        <script src="./script/redir.js" type="text/javascript"></script>
        <script src="./script/childprocess.js" type="text/javascript"></script>
        <script src="./script/deleteContact.js" type="text/javascript"></script>
    </head>
    <body>
        <header><img id="headerWordmark" src="./images/SVG/wordmark.svg" alt="Nexo" onclick="redir('./index.html', 0.1)"></header>
        <nav id="nav">
            <div id="searchBar">
                <input type="text" name="searchBarInput" id="searchBarInput" placeholder="Pesquise por um contato">
                <button type="button" id="searchBarBtn"><img id="searchBarIcon" src="./images/SVG/search.svg" alt=""></button>
            </div>
        </nav>

        <main id="main">
            <section id="leftSection">
                <nav id="navigationBar">
                    <span class="navigationBar_item" id="navigationBar_item_contacts">
                        <img src="./images/SVG/contacts.svg">
                        <p>Contatos</p>
                    </span>
                    <span class="navigationBar_item" id="navigationBar_item_new" onclick="redir('./newContact.html', 0.1)">
                        <img src="./images/SVG/add_circle.svg">
                        <p>Novo</p>
                    </span>
                </nav>
            </section>
            <section id="centerSection">
                <div id="contactListContainer"></div>
            </section>
            <section id="rightSection">
                <p><em>Lorem Ipsum</em></p>
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                    In rhoncus ultricies tellus in semper. Sed vehicula lectus vel mauris sodales,
                    eget pharetra nisi volutpat. Pellentesque dignissim id odio finibus convallis.
                    Etiam vitae nulla leo. Nulla commodo fringilla accumsan. Nunc hendrerit mi leo, 
                    aculis tempus enim dictum sed. Cras quis urna non sem condimentum gravida ut et
                    magna. Vestibulum dui orci, euismod vulputate tincidunt in, cursus vitae augue.
                    Proin viverra neque ut ullamcorper sagittis. Vivamus a metus pellentesque,
                    tincidunt tellus a, luctus tortor. Nulla malesuada feugiat velit quis porta.
                    Cras orci nunc, mollis et congue in, bibendum a lorem. 
                </p>
            </section>

        </main>

    </body>
</html>


<!-- SCRIPT QUE LISTA OS CONTATOS -->
<script>

    const fs = require('fs').promises;
    const path = require('path');

    // Função para gerar o HTML
    function generateContactList(contacts) {
        let html = '';

        // Ordena os contatos pelo nome antes de gerar o HTML
        contacts.sort((a, b) => a.name.localeCompare(b.name));

        contacts.forEach((contact, index) => {
            contact.phone = contact.phone.replace(/[^0-9()]/g, '');
            contact.instagram = contact.instagram.replace(/@/g, '');
            const contactId = `contact${index + 1}`;
            html += `
                <div class="contactList_item">
                    <input type="checkbox" class="contactList_itemToggle" id="${contactId}">
                    
                    <label for="${contactId}" class="contactList_itemInfo">
                        <img class="contactList_avatar" src="./images/SVG/avatar.svg">
                        <div class="contactList_info">
                            <p class="contactList_name">${contact.name}</p>
                            <p class="contactList_phone">${contact.phone}</p>
                        </div>
                    </label>

                    <div class="contactList_actions">
                        <button name="contactList_actionInfo" class="contactList_actionBtn" title="info" onclick="infoRedirect('${contact.phone}')">
                            <img src="./images/SVG/info.svg">
                        </button>
                        <button name="contactList_actionEmail" class="contactList_actionBtn" title="Email" onclick="openWithBrowser('https://mail.google.com/mail/?view=cm&to=` + contact.email + `')">
                            <img src="./images/SVG/mail2.svg">
                        </button>
                        <button name="contactList_actionWhatsapp" class="contactList_actionBtn" title="Whatsapp" onclick="openWhatsAppWithNumber('${contact.phone.replace(/[^0-9]/g, '')}')">
                            <img src="./images/SVG/whatsapp.svg">
                        </button>
                        <button name="contactList_actionInstagram" class="contactList_actionBtn" title="Instagram" onclick="openWithBrowser('https://instagram.com/${contact.instagram}')">
                            <img src="./images/SVG/instagram2.svg">
                        </button>

                        <span class="contactList_deleteBtn" onclick="deleteContact('${contact.phone}')" title="Excluir"><img src="./images/SVG/trash.svg"></span>
                    </div>
                    <span class="separator"></span>
                </div>
            `;
        });
        return html;
    }

    // Função principal para ler contatos
    async function readContacts() {
        const contactListContainer = document.getElementById('contactListContainer');
        
        try {
            const filePath = path.join(__dirname, './contacts.json');
            const data = await fs.readFile(filePath, 'utf8');
            const contacts = JSON.parse(data);
            
            const html = generateContactList(contacts);
            contactListContainer.innerHTML = html;
            
            return html; // Retorna o HTML gerado
        } catch (error) {
            console.error('Erro ao buscar os contatos:', error);
            return '';
        }
    }

    // Chama a função para ler os contatos e exibir o HTML
    readContacts();
</script>